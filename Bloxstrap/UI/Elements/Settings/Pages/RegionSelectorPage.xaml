<ui:UiPage
    x:Class="Bloxstrap.UI.Elements.Settings.Pages.RegionSelectorPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="clr-namespace:Bloxstrap.UI.Elements.Controls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:dmodels="clr-namespace:Bloxstrap.UI.ViewModels.Settings"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:resources="clr-namespace:Bloxstrap.Resources"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    Title="RegionSelectorPage"
    d:DesignHeight="590"
    d:DesignWidth="900"
    Scrollable="False"
    mc:Ignorable="d">

    <Grid Margin="0,0,14,14">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <controls:MarkdownTextBlock
            Grid.Row="0"
            Margin="0,0,0,16"
            FontSize="14"
            Foreground="{DynamicResource TextFillColorSecondaryBrush}"
            MarkdownText="{Binding Source={x:Static resources:Strings.Menu_RegionSelector_Description}, Converter={StaticResource StringFormatConverter}, ConverterParameter='https://www.rovalra.com'}"
            TextWrapping="Wrap" />

        <Border
            Grid.Row="1"
            Margin="0,0,0,16"
            Padding="16"
            Background="{DynamicResource NormalDarkAndLightBackground}"
            CornerRadius="8">
            <StackPanel>

                <StackPanel Margin="0,0,0,10" Orientation="Horizontal">
                    <TextBlock
                        VerticalAlignment="Center"
                        Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                        Text="{x:Static resources:Strings.Menu_RegionSelector_FindGame}" />

                    <ComboBox
                        x:Name="SearchComboBox"
                        MinWidth="200"
                        MaxWidth="500"
                        Margin="8,0,0,0"
                        VerticalAlignment="Center"
                        IsEditable="True"
                        IsTextSearchEnabled="True"
                        ItemsSource="{Binding SearchResults}"
                        SelectedItem="{Binding SelectedSearchResult, Mode=TwoWay}"
                        StaysOpenOnEdit="True"
                        Text="{Binding SearchQuery, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                        TextSearch.TextPath="RootPlaceId">

                        <ComboBox.ItemTemplate>
                            <DataTemplate>
                                <Grid Margin="2,0,2,0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>

                                    <TextBlock
                                        Grid.Column="0"
                                        VerticalAlignment="Center"
                                        FontWeight="Normal"
                                        Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                                        Text="{Binding Name}"
                                        TextTrimming="CharacterEllipsis" />

                                    <StackPanel
                                        Grid.Column="1"
                                        Margin="8,0,0,0"
                                        HorizontalAlignment="Right"
                                        VerticalAlignment="Center"
                                        Orientation="Horizontal">
                                        <ui:SymbolIcon
                                            Margin="0,0,6,0"
                                            VerticalAlignment="Center"
                                            Filled="True"
                                            FontSize="18"
                                            Symbol="People24" />
                                        <TextBlock
                                            VerticalAlignment="Center"
                                            Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                                            Text="{Binding PlayerCount, Converter={StaticResource NumberAbbreviationConverter}}" />
                                    </StackPanel>
                                </Grid>
                            </DataTemplate>
                        </ComboBox.ItemTemplate>
                    </ComboBox>

                    <TextBlock
                        Margin="8,0,0,0"
                        VerticalAlignment="Center"
                        Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                        Text="{x:Static resources:Strings.Menu_RegionSelector_ServerSize}" />

                    <ComboBox
                        x:Name="SortOrderComboBox"
                        Width="150"
                        Margin="8,0,0,0"
                        VerticalAlignment="Center"
                        DisplayMemberPath="Content"
                        ItemsSource="{Binding SortOrderOptions}"
                        SelectedValue="{Binding SelectedSortOrder}"
                        SelectedValuePath="Tag" />
                </StackPanel>

                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0" Orientation="Horizontal">
                        <TextBlock
                            VerticalAlignment="Center"
                            Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                            Text="{x:Static resources:Strings.Menu_RegionSelector_Region}" />

                        <ComboBox
                            x:Name="RegionComboBox"
                            Width="200"
                            Margin="8,0,0,0"
                            VerticalAlignment="Center"
                            ItemsSource="{Binding Regions}"
                            SelectedItem="{Binding SelectedRegion}" />

                        <Button
                            Width="100"
                            Margin="8,0,0,0"
                            VerticalAlignment="Center"
                            Command="{Binding SearchCommand}"
                            CommandParameter="{Binding Text, ElementName=SearchComboBox}"
                            Content="{x:Static resources:Strings.Common_Search}" />

                        <Button
                            Width="100"
                            Margin="8,0,0,0"
                            VerticalAlignment="Center"
                            Command="{Binding LoadMoreCommand}"
                            Content="{x:Static resources:Strings.Menu_RegionSelector_LoadMore}" />

                        <Button Content="Refresh Cookie"
                            Margin="8,0,0,0"
                            VerticalAlignment="Center"
                            Command="{Binding RefreshCookiesCommand}"
                            IsEnabled="{Binding IsNotLoading}" />
                    </StackPanel>
                </Grid>

            </StackPanel>
        </Border>

        <Grid Grid.Row="2">
            <DataGrid
                AutoGenerateColumns="False"
                CanUserAddRows="False"
                HeadersVisibility="Column"
                IsReadOnly="True"
                ItemsSource="{Binding Servers}"
                SelectionMode="Single">

                <DataGrid.Style>
                    <Style BasedOn="{StaticResource {x:Type DataGrid}}" TargetType="DataGrid">
                        <Setter Property="Background" Value="{DynamicResource NormalDarkAndLightBackground}" />
                        <Setter Property="BorderThickness" Value="1" />
                        <Setter Property="GridLinesVisibility" Value="Horizontal" />
                        <Setter Property="HorizontalGridLinesBrush" Value="#11000000" />
                        <Setter Property="VerticalGridLinesBrush" Value="Transparent" />
                    </Style>
                </DataGrid.Style>

                <DataGrid.ColumnHeaderStyle>
                    <Style TargetType="DataGridColumnHeader">
                        <Setter Property="Background" Value="{DynamicResource ControlFillColorTertiaryBrush}" />
                        <Setter Property="Foreground" Value="{DynamicResource TextFillColorPrimaryBrush}" />
                        <Setter Property="Height" Value="30" />
                        <Setter Property="Padding" Value="8,0,12,0" />
                        <Setter Property="BorderBrush" Value="{DynamicResource ControlElevationBorderBrush}" />
                        <Setter Property="BorderThickness" Value="1" />
                        <Setter Property="FontWeight" Value="SemiBold" />
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="{DynamicResource ControlFillColorSecondaryBrush}" />
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </DataGrid.ColumnHeaderStyle>

                <DataGrid.CellStyle>
                    <Style TargetType="DataGridCell">
                        <Setter Property="Height" Value="30" />
                        <Setter Property="Padding" Value="6,0,6,0" />
                        <Setter Property="Background" Value="Transparent" />
                        <Setter Property="BorderThickness" Value="0" />
                        <Setter Property="Foreground" Value="{DynamicResource TextFillColorPrimaryBrush}" />
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="DataGridCell">
                                    <Border Padding="{TemplateBinding Padding}" Background="{TemplateBinding Background}">
                                        <ContentPresenter HorizontalAlignment="Stretch" VerticalAlignment="Center" />
                                    </Border>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#14000000" />
                            </Trigger>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter Property="Background" Value="#59007ACC" />
                                <Setter Property="Foreground" Value="#F0F0F0" />
                            </Trigger>
                            <MultiTrigger>
                                <MultiTrigger.Conditions>
                                    <Condition Property="IsSelected" Value="True" />
                                    <Condition Property="IsMouseOver" Value="True" />
                                </MultiTrigger.Conditions>
                                <Setter Property="Background" Value="#8C007ACC" />
                            </MultiTrigger>
                        </Style.Triggers>
                    </Style>
                </DataGrid.CellStyle>

                <DataGrid.Columns>
                    <DataGridTextColumn
                        Width="40"
                        Binding="{Binding Number}"
                        Header="#">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="HorizontalAlignment" Value="Center" />
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>

                    <DataGridTextColumn
                        Width="*"
                        Binding="{Binding ServerId}"
                        Header="{x:Static resources:Strings.Menu_RegionSelector_Servers_ServerID}" />

                    <DataGridTextColumn
                        Width="150"
                        Binding="{Binding Uptime}"
                        Header="{x:Static resources:Strings.Menu_RegionSelector_Servers_ServerUptime}" />

                    <DataGridTextColumn
                        Width="80"
                        Binding="{Binding Players}"
                        Header="{x:Static resources:Strings.Menu_RegionSelector_Servers_Players}" />


                    <DataGridTextColumn
                        Width="120"
                        Binding="{Binding Region}"
                        Header="{x:Static resources:Strings.Menu_RegionSelector_Servers_Region}" />

                    <DataGridTemplateColumn Width="100" Header="Join">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Button
                                    Width="100"
                                    Height="28"
                                    HorizontalAlignment="Center"
                                    Command="{Binding JoinCommand}"
                                    Content="{x:Static resources:Strings.Menu_RegionSelector_Servers_Join}" />
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>

            <TextBlock
                Margin="20"
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                FontSize="16"
                FontWeight="Medium"
                Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                IsHitTestVisible="False"
                Text="{Binding ServerListMessage}"
                TextWrapping="Wrap"
                Visibility="{Binding IsServerListEmptyAndNotLoading, Converter={StaticResource BooleanToVisibilityConverter}}" />

            <Grid Background="{DynamicResource PrimaryBackgroundColor}" Visibility="{Binding ShowLoadingIndicator, Converter={StaticResource BooleanToVisibilityConverter}}">
                <StackPanel
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    Orientation="Horizontal">
                    <ui:ProgressRing
                        Width="32"
                        Height="32"
                        Margin="0,0,12,0"
                        IsIndeterminate="True" />
                    <TextBlock
                        VerticalAlignment="Center"
                        FontSize="14"
                        FontWeight="Medium"
                        Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                        Text="{Binding LoadingMessage}" />
                </StackPanel>
            </Grid>
        </Grid>
    </Grid>
</ui:UiPage>