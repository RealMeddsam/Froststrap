<base:WpfUiWindow x:Class="Bloxstrap.UI.Elements.Dialogs.PublicFlaglistsDialog"
                  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                  xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                  xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
                  xmlns:base="clr-namespace:Bloxstrap.UI.Elements.Base"
                  xmlns:control="clr-namespace:Bloxstrap.UI.Elements.Controls"
                  mc:Ignorable="d"
                  Title="Public Flaglists"
                  Width="700"
                  WindowStartupLocation="CenterOwner"
                  Background="{ui:ThemeResource ApplicationBackgroundBrush}"
                  ExtendsContentIntoTitleBar="True"
                  WindowBackdropType="Mica">

    <Grid>
        <Grid.Background>
            <DynamicResource ResourceKey="WindowBackgroundGradient" />
        </Grid.Background>

        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <ui:TitleBar Grid.Row="0" Padding="8"
                     Title="Public Flaglists"
                     Icon="pack://application:,,,/Bloxstrap.ico"
                     ShowMinimize="False"
                     ShowMaximize="False" />

        <TabControl Grid.Row="1" Margin="16,0,16,16" Padding="0,8,0,0" Height="Auto">
            <TabItem Header="Publish">
                <StackPanel Margin="8,8,8,0" VerticalAlignment="Top" DataContext="{Binding}" Height="315">
                    <TextBlock Text="Flaglist Title:" FontWeight="SemiBold" Margin="0,0,0,4"/>
                    <ui:TextBox Text="{Binding Title, UpdateSourceTrigger=PropertyChanged}" PlaceholderText="Enter flaglist title" Margin="0,0,0,10" />

                    <TextBlock Text="Flaglist JSON:" FontWeight="SemiBold" Margin="0,0,0,4"/>
                    <ui:TextBox Text="{Binding Json, UpdateSourceTrigger=PropertyChanged}" AcceptsReturn="True" MinHeight="80" MaxHeight="150" TextWrapping="Wrap" VerticalScrollBarVisibility="Auto" PlaceholderText="Paste FastFlag JSON here..." />

                    <StackPanel Orientation="Horizontal" Margin="0,8,0,0" HorizontalAlignment="Left">
                        <Button HorizontalAlignment="Left" Margin="0,8,4,0" Command="{Binding UploadCommand}" Content="Validate and Upload" />
                        <Button HorizontalAlignment="Left" Margin="0,8,0,0" Command="{Binding GetCurrentFlagsCommand}" Content="Get Current Flags" />
                    </StackPanel>

                    <TextBlock Text="{Binding StatusMessage}" Margin="8,8,0,0" Foreground="{DynamicResource TextFillColorSecondaryBrush}" />
                </StackPanel>
            </TabItem>

            <!-- Browse Tab -->
            <TabItem Header="Browse">
                <Grid Margin="8,8,8,0" Height="Auto" MaxHeight="700">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <!-- Search Box -->
                    <ui:TextBox
            Text="{Binding SearchQuery, UpdateSourceTrigger=PropertyChanged}"
            PlaceholderText="Search Public Flags..."
            Margin="0,0,0,12" />

                    <!-- ScrollViewer + ItemsControl -->
                    <ScrollViewer Grid.Row="1"
                      VerticalScrollBarVisibility="Auto"
                      ScrollChanged="BrowseScrollViewer_ScrollChanged">

                        <StackPanel>
                            <ItemsControl ItemsSource="{Binding VisibleFlaglists}">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <WrapPanel IsItemsHost="True" Orientation="Horizontal" />
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>

                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border CornerRadius="8"
                                    Background="#19000000"
                                    Margin="6"
                                    Padding="12"
                                    MaxWidth="300"
                                    MinWidth="250">
                                            <StackPanel>
                                                <TextBlock Text="{Binding Title}" FontSize="16" FontWeight="Bold" Margin="0,0,0,6"/>

                                                <Grid Margin="0,0,0,6">
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*" />
                                                        <ColumnDefinition Width="Auto" />
                                                    </Grid.ColumnDefinitions>

                                                    <TextBlock Text="{Binding CreatedAt, StringFormat='Published on {0:MMM dd, yyyy HH:mm}'}"
                                                   Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                                                   VerticalAlignment="Center"
                                                   Grid.Column="0" />

                                                    <Button Content="Copy"
                                                Width="60"
                                                Height="24"
                                                Padding="0"
                                                Margin="8,0,0,0"
                                                VerticalAlignment="Center"
                                                Grid.Column="1"
                                                Command="{Binding DataContext.CopyJsonCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                CommandParameter="{Binding}" />
                                                </Grid>

                                                <ScrollViewer VerticalScrollBarVisibility="Auto" MaxHeight="120">
                                                    <TextBox Text="{Binding Json}"
                                                 IsReadOnly="True"
                                                 TextWrapping="Wrap"
                                                 Background="{DynamicResource ControlFillColorDefaultBrush}"
                                                 FontFamily="Consolas"
                                                 FontSize="12"
                                                 Padding="6"
                                                 BorderThickness="0"
                                                 VerticalScrollBarVisibility="Disabled"
                                                 HorizontalScrollBarVisibility="Disabled"
                                                 MinHeight="60" />
                                                </ScrollViewer>
                                            </StackPanel>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                            <TextBlock Text="No results found." Foreground="{DynamicResource TextFillColorSecondaryBrush}" FontStyle="Italic" HorizontalAlignment="Center" Margin="0,20,0,0" Visibility="{Binding IsNoResultsFound, Converter={StaticResource BooleanToVisibilityConverter}}" />

                            <TextBlock Text="Loading more..."
                                Foreground="{DynamicResource TextFillColorSecondaryBrush}" FontStyle="Italic" Margin="12" Visibility="{Binding ShowLoadingMoreText, Converter={StaticResource BooleanToVisibilityConverter}}" />

                        </StackPanel>
                    </ScrollViewer>
                </Grid>
            </TabItem>
        </TabControl>

        <Border Grid.Row="2" Padding="15" Background="{DynamicResource PrimaryBackgroundColor}">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                <Button MinWidth="100" Content="Close" IsCancel="True" FontWeight="Medium" />
            </StackPanel>
        </Border>
    </Grid>
</base:WpfUiWindow>